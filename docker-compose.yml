version: '3.9'

services:
  db:
    image: mcr.microsoft.com/azure-sql-edge:latest # ARM 호환
    user: '0:0' # 로컬 권한 문제( /.system 디렉터리 생성 실패) 방지용
    container_name: stayops-db
    environment:
      ACCEPT_EULA: 'Y'
      MSSQL_PID: 'Developer'
      SA_PASSWORD: stayops@1234
    ports:
      - '1433:1433'
    volumes:
      - stayops_db_data:/var/opt/mssql
    networks:
      - stayops-net

  web:
    build:
      context: ./frontend/stayops-admin
      dockerfile: Dockerfile # frontend/stayops-admin/Dockerfile (npm run dev)
    container_name: stayops-web
    working_dir: /app
    volumes:
      - ./frontend/stayops-admin:/app # 소스 코드 마운트 → Next.js 핫 리로드
      - stayops_node_modules:/app/node_modules
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_BASE_URL: http://localhost:5100
    ports:
      - '5101:3000'
    networks:
      - stayops-net
    tty: true
    stdin_open: true

networks:
  stayops-net:

volumes:
  stayops_db_data:
  stayops_node_modules:
