# StayOps PMS 백엔드 설계 범위 정의서

본 문서는 StayOps 호텔 미니 PMS 백엔드의 기능 범위와 모듈 구성을 정의합니다. 포트폴리오 데모 목적에 맞춰 핵심 기능에 집중하면서도, 확장 가능하고 유지보수하기 쉬운 설계를 목표로 합니다.

## 1. StayOps의 포지션 & 범위 기준

- 대상: **중소형 호텔 / 게스트하우스** 1~몇 개 지점 운영
- 주요 사용자:
  - **Admin**: 시스템/호텔 설정, 요금 정책, 계정 관리
  - **Staff**: 예약 처리, 체크인/체크아웃, 객실 상태 관리
- 방향성:
  - 고객용 예약 화면은 **포함하지 않음**
  - 다만, 필요시 **공개 API 형태의 예약/가용성 조회**는 제공 가능(프론트 없이)

---

## 2. 모듈 단위 기능 범위 정리

### 2.1. 인증/권한 (Auth & User Management) – ✅ _MVP 포함_

**기능**

- 사용자 계정 관리
  - Admin 계정 생성(초기 시드 + 이후 Admin이 관리)
  - Staff 계정 생성/비활성화
- 로그인 / 로그아웃
- JWT 기반 인증
- 역할(Role) 기반 권한:
  - Admin: 모든 리소스 관리 가능
  - Staff: 예약, 체크인/체크아웃, 객실 상태 변경 등 제한된 기능

**포인트**

- 포트폴리오에서 **보안/권한 모델**을 설명할 수 있는 영역

---

### 2.2. 호텔 & 객실 인벤토리 관리 – ✅ _MVP 핵심_

**기능**

- 호텔(지점) 관리
  - 초기 버전에서는 **단일 호텔** 기준으로 구현
  - ERD/도메인 설계 수준에서는 multi-hotel 고려(확장 여지 설명)
- 객실 타입(RoomType)
  - 예: Standard Double, Deluxe Twin, Suite 등
  - 인원 제한, 기본 요금, 설명 등
- 객실(Room)
  - 호실(101, 102 등)
  - 객실 타입에 매핑
  - 상태: Active / Inactive (유지보수/장기점검 등)
  - 상태가 Inactive인 객실은 예약 생성/배정 불가

**필수 시나리오**

- 객실 타입 CRUD
- 객실 CRUD
- 특정 날짜 기준 객실 상태 조회(운영 관점에서 필요)
- Multi-hotel 확장 시 글로벌 키 전략(호텔 코드 + 객실 번호 조합)으로 충돌 방지

---

### 2.3. 예약 관리(Reservation Lifecycle) – ✅ _MVP 최중요_

**예약 엔티티의 기본 속성**

- 예약 번호
- 객실 타입 / 실제 배정 객실
- 체크인 날짜 / 체크아웃 날짜
- 투숙 인원
- 금액(요약)
- 상태:
  - `Pending` (임시/보류)
  - `Confirmed` (확정)
  - `CheckedIn`
  - `CheckedOut`
  - `Cancelled`

**기능**

- 예약 생성 (백오피스 기준)
  - 객실 타입 + 날짜 입력 → 가용 객실 중 하나 선택/자동 배정
  - 객실 배정 전략: 기본은 **자동 배정**, 필요 시 동일 타입 내 수동 변경 가능(다른 타입 변경은 새 예약으로 처리)
- 예약 조회
  - 리스트(필터: 날짜, 상태, 객실 타입)
  - 상세 조회
- 예약 변경
  - 날짜 변경(가능 여부 검증)
  - 객실 변경(배정된 객실만 타입 내 교체 가능)
- 예약 취소
- 예약 상태 전이
  - `Confirmed → CheckedIn → CheckedOut`
  - `Confirmed → Cancelled`
  - 노쇼(No-Show) 처리 시 `Confirmed → Cancelled (No-Show)`로 기록

**핵심 포인트**

- **동일 객실에 대해 중복 예약 방지**
- 도메인 규칙을 엔티티/도메인 서비스에 명확히 캡슐화
- 상태 전이 규칙을 코드로 잘 드러내는 것(포트폴리오 어필 지점)
- 체크인/체크아웃 기준 시각(예: 호텔 타임존 기준 15:00/11:00)과 타임존을 명시하고, 지각 체크인·얼리 체크아웃 시 정책(요금/상태)을 정의

---

### 2.4. 가용성(Availability) & 재고 계산 – ✅ _MVP 핵심_

**기능**

- 날짜 범위 + 객실 타입 기준으로:
  - 총 객실 수
  - 예약된 객실 수
  - 사용 가능한 객실 수
  - 응답 단위: 기본은 **객실 타입 집계**(타입별 가용 수), 필요 시 객실별 세부 응답 옵션으로 확장
- API 예시:
  - `GET /api/availability?from=2025-11-01&to=2025-11-07&roomTypeId=...`

**고려사항**

- **경쟁 상태(동시 예약)**에서 재고가 음수가 되지 않도록
  - DB 레벨 제약(Unique Index + 트랜잭션)
  - 낙관적 락(Version 컬럼) 등 중 하나 선택

**포트폴리오 포인트**

- “동시성 제어 & 재고 정합성”을 설계/문서화/테스트로 보여주기 좋음

---

### 2.5. 요금/가격 정책 (Rate Management) – ✅ _MVP 축소 버전 포함_

**기본 방향**

- 초기는 **단순 Daily Rate 모델**로 시작:
  - 날짜별 요금 설정: `2025-12-24 → 150,000원`
  - 요일/성수기 로직은 1차에서는 수동 설정으로 단순화

**기능**

- 객실 타입별 기본 요금
- 특정 날짜 구간 별도 요금 설정(성수기, 연휴 등)
- 요금 조회
  - 날짜 범위 + 객실 타입 기준
  - 응답에 **1박 단가**와 **총액 브레이크다운**(세금/봉사료 포함 여부 명시)을 포함
  - 통화는 KRW 고정, 세금/봉사료는 초기 버전에서 포함 여부를 명시(기본: 포함)

**추가 확장(문서로만 강조 가능)**

- 주중/주말 요금 규칙
- 시즌(Season) 단위 요금 정책
- 취소 정책/환불 규칙(수수료 적용 시점, No-Show 패널티)을 “포함/추후”로 구분해 명시

---

### 2.6. 프론트 오피스(Front Office) – 체크인/체크아웃 – ✅ _MVP 포함_

**기능**

- 오늘 체크인 예정 예약 목록
- 오늘 체크아웃 예정 예약 목록
- 체크인 처리:
  - 예약 상태 `Confirmed → CheckedIn`
  - 실제 도착 시간 기록
- 체크아웃 처리:
  - `CheckedIn → CheckedOut`
  - 실제 퇴실 시간 기록

**목표**

- 프론트 오피스 직원이 **당일 운영**에 사용하는 핵심 화면/기능을 백엔드 API로 제공

---

### 2.7. 객실 상태 / 하우스키핑(간단 버전) – ✅ _MVP 경량 버전 포함_

완전한 하우스키핑 시스템까지는 아니더라도, **포트폴리오용 구조**로는 일부 포함하면 좋습니다.

**기능(경량 버전)**

- 객실 상태:
  - `Clean` / `Dirty` / `OutOfService`
- 체크인/체크아웃과 연동:
  - 체크아웃 시 `Dirty`로 자동 변경
- 직원이 상태를 변경하는 API
  - `/api/rooms/{id}/status`
  - 객실 상태가 `Inactive/OutOfService`인 경우 새 예약 생성/배정을 차단

**포지션**

- 이 모듈은 “확장성 있는 PMS 구조”를 보여주는 좋은 사례
  → 실제 구현은 심플하게, 설명은 디테일하게

---

### 2.8. 리포트 & 대시보드 – ✅ _MVP 매우 간단 버전 포함_

**MVP에서 최소 포함**

- 일자별 예약 수
- 일자별 체크인/체크아웃 수
- 객실 타입별 점유율(Occupancy Rate) 간단 계산

**API 예시**

- `GET /api/dashboard/daily-summary?date=2025-11-13`
- `GET /api/dashboard/occupancy?from=...&to=...`

처음에는 **API만** 제공하고,
프론트는 간단한 Admin UI 한 페이지 정도로 요약 정보만 표기.

- 점유율 공식 명시: 분모는 **가동 객실 수**(Inactive/OutOfService 제외), 타임존은 호텔 기준, 취소/노쇼는 제외하고 CheckedIn/CheckedOut만 집계

---

### 2.9. 시스템/운영 기능 – ✅ _MVP 포함 (기본 수준)_

**기능**

- CreatedAt/UpdatedAt, CreatedBy/UpdatedBy
- 기본적인 감사 정보(Audit) 필드
- 에러 로깅 구조 (Serilog 등 선택 가능)
- Swagger(OpenAPI) 문서화
- DB 마이그레이션 + 시드 데이터 전략(데모용 기본 호텔/객실/요금 삽입)
- 헬스체크 엔드포인트(`/health`), 구조적 로깅 + 메트릭/트레이싱 수집 범위 정의

**포트폴리오 포인트**

- “실제 서비스처럼 운영을 고려한 설계”를 강조할 수 있는 영역

---

### 2.10. 고객용 공개 API – ⭕ _옵션: API만 제공_

UI는 없지만, 아래 API는 제공 가능:

- `GET /public/availability`
- `POST /public/reservations` (간단한 고객 예약 등록)

**전략**

- 실제 구현은 백오피스 로직 재사용
- `POST /public/reservations`는 idempotency 키(헤더)로 중복 생성 방지, 레이트리밋(예: IP/키 기준)을 적용
- 문서에서:

  > “향후 호텔 공식 웹/앱, OTA 채널과 연동 가능한 API를 염두에 두고 설계했다.”
  > 라고 설명하면 설계 역량을 보여주기 좋음.

---

## 3. 범위 요약 (MVP vs 확장)

| 영역                       | 상태           |
| -------------------------- | -------------- |
| 인증/권한                  | ✅ MVP 포함    |
| 호텔/객실/객실 타입 관리   | ✅ MVP 포함    |
| 예약 생성/조회/변경/취소   | ✅ MVP 포함    |
| 가용성(Availability) 계산  | ✅ MVP 포함    |
| 요금/가격 정책(Daily Rate) | ✅ MVP 포함    |
| 체크인/체크아웃            | ✅ MVP 포함    |
| 간단 하우스키핑(객실 상태) | ✅ MVP 포함    |
| 대시보드/리포트(간단)      | ✅ MVP 포함    |
| 고객용 예약/가용성 API     | ⭕ 옵션(API만) |
| 결제/PG 연동               | ❌ 범위 제외   |
| 채널 매니저(OTA 연동)      | ❌ 범위 제외   |
| 복잡한 세금/정산 시스템    | ❌ 범위 제외   |

---
